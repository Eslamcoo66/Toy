<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„ØºØ±Ø§Ù‚Ø© Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f0f2f5;padding:20px;direction:rtl;}
h1{text-align:center;margin-bottom:20px;}
.group{padding:15px;margin-bottom:25px;border-radius:12px;color:#fff;box-shadow:0 4px 10px rgba(0,0,0,0.15);}
.group.A{background:linear-gradient(45deg,#4a90e2,#357abd);}
.group.B{background:linear-gradient(45deg,#27ae60,#1e8449);}
.group.E{background:linear-gradient(45deg,#f39c12,#d68910);}
.group.F{background:linear-gradient(45deg,#c0392b,#922b21);}
table{width:100%;border-collapse:collapse;margin-top:10px;background:#fff;color:#000;border-radius:8px;overflow:hidden;}
th,td{border:1px solid #ddd;padding:8px;text-align:center;}
th:first-child,td:first-child{text-align:center;font-weight:bold;}
.leader{background:#fff3b0 !important;font-weight:bold;}
th{background:#ececec;}
tr:hover{background:#eaf2ff;}
button{padding:6px 12px;margin:3px;cursor:pointer;border-radius:6px;border:none;background:#333;color:#fff;}
input,select{padding:4px;}
.lastUpdate{font-weight:bold;margin-bottom:6px;color:#fff;}
</style>
</head>
<body>

<h1>ğŸ† Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„ØºØ±Ø§Ù‚Ø© Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</h1>

<div id="masterPanel" style="display:block"></div>
<div id="audience"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, onValue, set, push, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// === Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ===
const firebaseConfig={
  apiKey:"YOUR_KEY",
  authDomain:"gharaqa-ramadan.firebaseapp.com",
  databaseURL:"https://gharaqa-ramadan-default-rtdb.firebaseio.com",
  projectId:"gharaqa-ramadan"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

// ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø§Ø³ØªØ±
const MASTER_PASSWORD="7890";

// Ø§Ù„ÙØ±Ù‚ Ø¨Ø£Ø³Ù…Ø§Ø¦Ù‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠØ©
const groups={
  A:["Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¹Ø¨Ø¯Ø§Ù„ÙˆÙ‡Ø§Ø¨","Ø´Ø¨Ø§Ø¨ Ø§Ù„Ø´ÙˆÙƒØ©","Ù…Ø­Ù„Ø© ÙƒÙŠÙ„","Ø£ØµØ¯Ù‚Ø§Ø¡ Ø­ÙˆØ´ Ø¹ÙŠØ³ÙŠ","Ø´Ø¨Ø§Ø¨ ÙƒÙˆÙ… Ø§Ù„Ø¨ÙˆØµ","Ø§Ù„ØºØ±Ø§Ù‚Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©"],
  B:["Ø§Ù„Ø´ÙˆÙƒØ© Ø§Ù„Ø­Ø§Ø¬Ø±","Ø§Ù„Ø±ÙŠÙ Ø§Ù„Ù…ØµØ±ÙŠ","Ø§Ù„ØµÙˆØ§Ù„Ø­ÙŠØ©","Ø§ØµØ¯Ù‚Ø§Ø¡ Ù…Ø­Ù…Ø¯ ÙØ¤Ø§Ø¯","Ø§Ù„Ø²Ù…Ø§Ù„ÙƒØ§ÙˆÙŠØ©","Ø§Ù„Ø¨Ø±Ù†ÙˆØ¬ÙŠ"],
  E:["Ù…Ù…ØªØ§Ø²","ÙƒÙˆÙ… Ø§Ù„Ø¨ÙˆØµ","Ù†Ø¬Ø¹ Ø§Ù„Ø¹Ø²Ø§ÙŠÙ…","Ø´Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ø³Ø§ÙƒØ±Ø©","Ø£Ù†ØµØ§Ù","Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ø³Ø§Ù…Ù‡ Ø§Ù„Ø¬Ø§Ø±Ø­ÙŠ"],
  F:["Ù†Ø¬ÙˆÙ… Ø¨Ø·ÙˆØ±Ø³","Ø§Ù„Ø¯ÙŠØ§Ø¨Ø©","ÙƒÙˆÙ… Ø§Ù„Ù‚Ù†Ø§Ø·Ø±","ÙÙ„Ø³Ø·ÙŠÙ†","Ø§Ù„Ø­Ø±ÙŠÙØ©","Ø§Ù„ØºØ±Ø§Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©"]
};

let isMaster=true; // Ø®Ù„ÙŠÙ‡Ø§ true Ù„ØªØ¸Ù‡Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…

const masterDiv=document.getElementById("masterPanel");
const audienceDiv=document.getElementById("audience");

// ==================== ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ ====================
window.renameTeam = async function(g,oldName,newName){
  if(!newName) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯");
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
  const snap = await get(ref(db,"matches/"+g));
  const data = snap.val() || {};
  const updates={};
  for(const k in data){
    const m=data[k];
    let changed=false;
    if(m.t1===oldName){ m.t1=newName; changed=true;}
    if(m.t2===oldName){ m.t2=newName; changed=true;}
    if(changed) updates[k]=m;
  }
  if(Object.keys(updates).length>0) set(ref(db,"matches/"+g), {...data, ...updates});
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙÙŠ groups
  groups[g]=groups[g].map(t=>t===oldName?newName:t);
  init();
}

// ==================== Ø­Ø°Ù Ø§Ù„ÙØ±ÙŠÙ‚ ====================
window.deleteTeam=async function(g,team){
  if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙØ±ÙŠÙ‚ "${team}"ØŸ`)) return;
  groups[g]=groups[g].filter(t=>t!==team);
  // Ø­Ø°Ù Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø§Ù„ÙØ±ÙŠÙ‚
  const snap=await get(ref(db,"matches/"+g));
  const data=snap.val()||{};
  for(const k in data){
    const m=data[k];
    if(m.t1===team || m.t2===team) set(ref(db,"matches/"+g+"/"+k), null);
  }
  init();
}

// ==================== Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø±Ø§Ø© ====================
window.addMatch=function(g){
  const t1=document.getElementById(`t1-${g}`).value;
  const t2=document.getElementById(`t2-${g}`).value;
  const s1=parseInt(document.getElementById(`s1-${g}`).value)||0;
  const s2=parseInt(document.getElementById(`s2-${g}`).value)||0;
  if(t1===t2) return alert("Ø§Ø®ØªØ§Ø± ÙØ±ÙŠÙ‚ÙŠÙ† Ù…Ø®ØªÙ„ÙÙŠÙ†");
  push(ref(db,"matches/"+g),{t1,t2,s1,s2,time:Date.now()});
}

// ==================== ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù Ù…Ø¨Ø§Ø±Ø§Ø© ====================
window.editMatch=function(g,k){
  const s1=prompt("Ù‡Ø¯Ù Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„");
  const s2=prompt("Ù‡Ø¯Ù Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ");
  if(s1===null||s2===null) return;
  set(ref(db,"matches/"+g+"/"+k+"/s1"),parseInt(s1)||0);
  set(ref(db,"matches/"+g+"/"+k+"/s2"),parseInt(s2)||0);
  set(ref(db,"matches/"+g+"/"+k+"/time"),Date.now());
}

window.delMatch=function(g,k){ if(confirm("Ø­Ø°ÙØŸ")) set(ref(db,"matches/"+g+"/"+k),null); }

// ==================== Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ====================
function listenGroup(g){
  onValue(ref(db,"matches/"+g),snap=>{
    const data=snap.val()||{};
    const teams={};
    for(const t of groups[g]){
      teams[t]={name:t,p:0,w:0,d:0,l:0,gf:0,ga:0,gd:0,pts:0};
    }
    let last=0;
    for(const k in data){
      const m=data[k];
      if(m.time>last) last=m.time;
      const a=teams[m.t1],b=teams[m.t2];
      if(!a||!b) continue;
      a.p++; b.p++;
      a.gf+=m.s1; a.ga+=m.s2;
      b.gf+=m.s2; b.ga+=m.s1;
      if(m.s1>m.s2){ a.w++;a.pts+=3; b.l++; }
      else if(m.s2>m.s1){ b.w++;b.pts+=3; a.l++; }
      else{ a.d++;b.d++;a.pts++;b.pts++; }
    }
    for(const t in teams) teams[t].gd=teams[t].gf-teams[t].ga;
    const sorted=Object.values(teams).sort((a,b)=>{
      if(b.pts!==a.pts) return b.pts-a.pts;
      if(b.gd!==a.gd) return b.gd-a.gd;
      return b.gf-a.gf;
    });
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
    const audBody=document.querySelector(`#audTable-${g} tbody`);
    audBody.innerHTML="";
    const mastBody=isMaster?document.querySelector(`#masterTable-${g} tbody`):null;
    if(mastBody) mastBody.innerHTML="";
    sorted.forEach(d=>{
      const row=`<td>${d.name}</td><td>${d.p}</td><td>${d.w}</td><td>${d.d}</td><td>${d.l}</td>
<td>${d.gf}</td><td>${d.ga}</td><td>${d.gd}</td><td>${d.pts}</td>`;
      const tr=document.createElement("tr"); tr.innerHTML=row;
      audBody.appendChild(tr);
      if(mastBody){ const tr2=document.createElement("tr"); tr2.innerHTML=row; mastBody.appendChild(tr2);}
    });
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
    const audM=document.querySelector(`#audMatches-${g} tbody`); audM.innerHTML="";
    const mastM=isMaster?document.querySelector(`#masterMatches-${g} tbody`):null; if(mastM) mastM.innerHTML="";
    for(const k in data){
      const m=data[k];
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${m.t1}</td><td>${m.s1}</td><td>${m.t2}</td><td>${m.s2}</td>`;
      audM.appendChild(tr);
      if(mastM){
        const tr2=document.createElement("tr");
        tr2.innerHTML=`<td>${m.t1}</td><td>${m.s1}</td><td>${m.t2}</td><td>${m.s2}</td>
<td><button onclick="editMatch('${g}','${k}')">ØªØ¹Ø¯ÙŠÙ„</button></td>
<td><button onclick="delMatch('${g}','${k}')">Ø­Ø°Ù</button></td>`;
        mastM.appendChild(tr2);
      }
    }
  });
}

// ==================== Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø§Ø³ØªØ± ÙˆØ§Ù„Ø¬Ù…Ù‡ÙˆØ± ====================
function init(){
  masterDiv.innerHTML=""; audienceDiv.innerHTML="";
  for(const g in groups){
    if(isMaster){
      const box=document.createElement("div"); box.className="group "+g;
      box.innerHTML=`<h2>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${g} (ØªØ­ÙƒÙ…)</h2>
<div style="margin-bottom:10px">
<select id="rename-${g}"></select>
<input id="newname-${g}" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
<button onclick="renameTeam('${g}',document.getElementById('rename-${g}').value,document.getElementById('newname-${g}').value)">ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…</button>
<button onclick="deleteTeam('${g}',document.getElementById('rename-${g}').value)">Ø­Ø°Ù Ø§Ù„ÙØ±ÙŠÙ‚</button>
</div>
<select id="t1-${g}"></select>
<input type="number" id="s1-${g}" value="0"> -
<input type="number" id="s2-${g}" value="0">
<select id="t2-${g}"></select>
<button onclick="addMatch('${g}')">Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø±Ø§Ø©</button>
<table id="masterTable-${g}">
<thead><tr><th>Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ù„Ø¹Ø¨</th><th>ÙÙˆØ²</th><th>ØªØ¹Ø§Ø¯Ù„</th><th>Ø®Ø³Ø§Ø±Ø©</th><th>+</th><th>-</th><th>ÙØ§Ø±Ù‚</th><th>Ù†Ù‚Ø§Ø·</th></tr></thead><tbody></tbody></table>
<h4>Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h4>
<table id="masterMatches-${g}">
<thead><tr><th>ÙØ±ÙŠÙ‚</th><th>Ø£Ù‡Ø¯Ø§Ù</th><th>ÙØ±ÙŠÙ‚</th><th>Ø£Ù‡Ø¯Ø§Ù</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th></tr></thead><tbody></tbody></table>`;
      masterDiv.appendChild(box);
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙÙŠ select
      for(const t of groups[g]){
        box.querySelector(`#rename-${g}`).add(new Option(t,t));
        box.querySelector(`#t1-${g}`).add(new Option(t,t));
        box.querySelector(`#t2-${g}`).add(new Option(t,t));
      }
    }

    // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±
    const aud=document.createElement("div"); aud.className="group "+g;
    aud.innerHTML=`<h2>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${g}</h2>
<table id="audTable-${g}">
<thead><tr><th>Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ù„Ø¹Ø¨</th><th>ÙÙˆØ²</th><th>ØªØ¹Ø§Ø¯Ù„</th><th>Ø®Ø³Ø§Ø±Ø©</th><th>+</th><th>-</th><th>ÙØ§Ø±Ù‚</th><th>Ù†Ù‚Ø§Ø·</th></tr></thead><tbody></tbody></table>
<h4>Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h4>
<table id="audMatches-${g}"><thead><tr><th>ÙØ±ÙŠÙ‚</th><th>Ø£Ù‡Ø¯Ø§Ù</th><th>ÙØ±ÙŠÙ‚</th><th>Ø£Ù‡Ø¯Ø§Ù</th></tr></thead><tbody></tbody></table>`;
    audienceDiv.appendChild(aud);
    listenGroup(g);
  }
}

init();
</script>
</body>
</html>